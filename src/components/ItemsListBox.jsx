import React from 'react';import i18n from 'i18n-js';import DataService from '../DataService.jsx';import ModalInfo from './ModalInfo.jsx';import ItemRow from './ItemRow.jsx';import FilterEvents from './FilterBox/FilterEvents.jsx';import FilterBoosts from './FilterBox/FilterBoosts.jsx';import FilterSlots from './FilterBox/FilterSlots.jsx';import FilterTypes from './FilterBox/FilterTypes.jsx';var ItemsListBox = React.createClass({  typeSelected: function(event) {    var selectedTypes = event.data();    this.setState({ onlyTypes: selectedTypes });  },  slotSelected: function(event) {    var selectedSlots = event.data();    this.setState({ onlySlots: selectedSlots });  },  eventSelected: function(event) {    var selectedEvents = event.data();    this.setState({ onlyEvents: selectedEvents });  },  boostSelected: function(event) {    var selectedBoosts = event.data();    this.setState({ onlyBoosts: selectedBoosts });  },  getInitialState: function() {    return {      onlyTypes: [],      onlyEvents: [],      onlyBoosts: [],      onlySlots: [],    };  },  componentWillMount: function() {    this.DataService = DataService();  },  isItemSelected: function(id) {    return this.props.isItemSelected(id);  },  getFilteredData: function(onlyTypes, onlySlots) {    var filteredData = this.DataService.getFilteredData(      onlyTypes,      this.state.onlyEvents,      [],      onlySlots    );    return filteredData.map(function(item, index) {      return (        <ItemRow clsName='first-row' item={item} key={"item-"+index}          selected={this.isItemSelected(item.href)}          ref={'row-item-'+item.href}          onItemSelected={this.props.onItemSelected}          modalInfo={this.refs.modal} />      )    }, this);  },  getFilteredDataWithAllBoosts: function(onlyTypes, onlySlots) {    var filteredData = this.DataService.getFilteredData(      onlyTypes,      this.state.onlyEvents,      [],      onlySlots    );    return filteredData.map(function(item, index) {      return (        <ItemRow clsName='first-row' item={item} key={"item-"+index}          selected={this.isItemSelected(item.href)}          ref={'row-item-'+item.href}          onItemSelected={this.props.onItemSelected}          modalInfo={this.refs.modal} />      )    }, this);  },  getBoostFilteredNodes: function(onlyTypes, onlySlots) {    var filteredData = this.DataService.getBoostFilteredData(      onlyTypes,      this.state.onlyEvents,      this.state.onlyBoosts,      onlySlots    );    if (this.state.onlyBoosts.length === 1) {      filteredData = this.DataService.sortByBoost(filteredData, this.state.onlyBoosts[0]);    } else if (this.state.onlyBoosts.length > 1) {      filteredData = this.DataService.sortByMultiBoost(filteredData, this.state.onlyBoosts);    }    var rowClass, firstRow;    return filteredData.map(function(item, index) {      firstRow = true;      return this.state.onlyBoosts.map(function(boost, index) {        var boostId = boost.toString();        var boost = item.stats_info[boostId];        if (boost !== undefined) {          if (firstRow) {            rowClass = 'first-row';            firstRow = false;          } else {            rowClass = null;            // rowClass = 'mini';          }          return (            <ItemRow clsName={rowClass} item={item} key={"item-"+index}              selected={this.isItemSelected(item.href)}              ref={'row-item-'+item.href}              boostId={boostId.toString()}              onItemSelected={this.props.onItemSelected}              modalInfo={this.refs.modal} />          )        } else {          return null;        }      }, this);    }, this);  },  filterFunc: function(onlyTypes, onlySlots) {    if (this.state.onlyBoosts.length === 0) {      return this.getFilteredData(onlyTypes, onlySlots);    } else {      return this.getBoostFilteredNodes(onlyTypes, onlySlots);    }  },  getCoreNode: function(slot) {    if (this.state.onlySlots.length === 0 || this.state.onlySlots.indexOf(slot) >= 0) {      var nodes = this.filterFunc(['Core'], [slot]);      if (nodes.length === 0) return null      else {        var header = i18n.t('items-list.'+slot) + ': ' + nodes.length;        header += i18n.t('items-list.items');        return (          <div>            <h4>{header}</h4>            <table className={"cores-list-"+slot}><tbody>              {nodes}            </tbody></table>          </div>        )      }    } else return null;  },  render: function() {    // if (this.props.activeTab !== 1) return null;    var coreNode = null;    var pieceNode = null;    var recipeNode = null;    if (this.state.onlyTypes.indexOf('Core') >= 0) {      coreNode = (        <div>          {this.getCoreNode('Helm')}          {this.getCoreNode('Armor')}          {this.getCoreNode('Feet')}          {this.getCoreNode('Weapon')}          {this.getCoreNode('Accessory')}        </div>      );    };    if (this.state.onlyTypes.indexOf('Piece') >= 0) {      var pieces = this.filterFunc(['Piece'], []);      if (pieces.length > 0) pieceNode = (        <div>          <h4>Pieces: {pieces.length} items</h4>          <table className="pieces-list"><tbody>            {pieces}          </tbody></table>        </div>      );    };    if (this.state.onlyTypes.indexOf('Crafting Recipes') >= 0) {      var recipes = this.filterFunc(['Crafting Recipes'], []);      if (recipes.length > 0) recipeNode = (        <div>          <h4>Recipes: {recipes.length} items</h4>          <table className="recipes-list"><tbody>            {recipes}          </tbody></table>        </div>      );    };    return (      <div className='cores-list-box'>        <ModalInfo ref="modal"/>        <div className="filter-panel">          <FilterBoosts onChange={this.boostSelected}/>          <FilterTypes onChange={this.typeSelected}/>          <FilterSlots onChange={this.slotSelected}/>          <FilterEvents onChange={this.eventSelected}/>        </div>        {coreNode}        {pieceNode}        {recipeNode}      </div>    );  },});module.exports = ItemsListBox;